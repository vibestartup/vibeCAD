<!DOCTYPE html>
<html>
<head>
  <title>OpenCascade.js Primitive Test</title>
  <style>
    body { font-family: monospace; padding: 20px; background: #1a1a2e; color: #eef; }
    .success { color: #4ade80; }
    .error { color: #f87171; }
    .info { color: #60a5fa; }
    pre { background: #0f0f23; padding: 10px; border-radius: 4px; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>OpenCascade.js Primitive Constructor Test</h1>
  <div id="output">Loading OpenCascade.js...</div>

  <script type="module">
    // Use unpkg CDN for opencascade.js
    const initOpenCascade = (await import('https://unpkg.com/opencascade.js@1.1.1/dist/opencascade.wasm.js')).default;

    const output = document.getElementById('output');

    function log(msg, type = 'info') {
      const div = document.createElement('div');
      div.className = type;
      div.textContent = msg;
      output.appendChild(div);
      console.log(msg);
    }

    function logPre(msg) {
      const pre = document.createElement('pre');
      pre.textContent = typeof msg === 'string' ? msg : JSON.stringify(msg, null, 2);
      output.appendChild(pre);
      console.log(msg);
    }

    async function runTests() {
      output.innerHTML = '<div class="info">Loading OpenCascade.js...</div>';

      try {
        const oc = await initOpenCascade();
        log('OpenCascade.js loaded successfully!', 'success');

        // List available constructors
        const boxConstructors = Object.keys(oc).filter(k => k.includes('BRepPrimAPI_MakeBox'));
        const cylConstructors = Object.keys(oc).filter(k => k.includes('BRepPrimAPI_MakeCylinder'));
        const sphereConstructors = Object.keys(oc).filter(k => k.includes('BRepPrimAPI_MakeSphere'));
        const coneConstructors = Object.keys(oc).filter(k => k.includes('BRepPrimAPI_MakeCone'));

        log('\n=== Available Constructors ===');
        log('Box: ' + boxConstructors.join(', '));
        log('Cylinder: ' + cylConstructors.join(', '));
        log('Sphere: ' + sphereConstructors.join(', '));
        log('Cone: ' + coneConstructors.join(', '));

        // Test Box constructors
        log('\n=== Testing Box Constructors ===');

        // Test _1 default constructor
        try {
          log('Testing BRepPrimAPI_MakeBox_1 (default)...');
          const box1 = new oc.BRepPrimAPI_MakeBox_1();
          log('  Created, IsDone: ' + box1.IsDone());

          // Check for Init methods
          const proto = Object.getPrototypeOf(box1);
          const methods = Object.keys(proto).filter(k => k.includes('Init'));
          log('  Init methods: ' + methods.join(', '));

          if (typeof box1.Init_1 === 'function') {
            log('  Calling Init_1(50, 50, 50)...');
            box1.Init_1(50, 50, 50);
            log('  After Init_1, IsDone: ' + box1.IsDone(), box1.IsDone() ? 'success' : 'error');
            if (box1.IsDone()) {
              const shape = box1.Shape();
              log('  Shape created successfully!', 'success');
            }
          }
        } catch (e) {
          log('  Box_1 error: ' + e.message, 'error');
        }

        // Test _2 constructor (dx, dy, dz)
        try {
          log('\nTesting BRepPrimAPI_MakeBox_2(50, 50, 50)...');
          const box2 = new oc.BRepPrimAPI_MakeBox_2(50, 50, 50);
          log('  IsDone: ' + box2.IsDone(), box2.IsDone() ? 'success' : 'error');
          if (box2.IsDone()) {
            const shape = box2.Shape();
            log('  Shape created successfully!', 'success');
          }
        } catch (e) {
          log('  Box_2 error: ' + e.message, 'error');
        }

        // Test _3 constructor (gp_Pnt, dx, dy, dz)
        try {
          log('\nTesting BRepPrimAPI_MakeBox_3(gp_Pnt, 50, 50, 50)...');
          const origin = new oc.gp_Pnt_1();
          const box3 = new oc.BRepPrimAPI_MakeBox_3(origin, 50, 50, 50);
          log('  IsDone: ' + box3.IsDone(), box3.IsDone() ? 'success' : 'error');
          if (box3.IsDone()) {
            const shape = box3.Shape();
            log('  Shape created successfully!', 'success');
          }
        } catch (e) {
          log('  Box_3 error: ' + e.message, 'error');
        }

        // Test _4 constructor (gp_Pnt, gp_Pnt)
        try {
          log('\nTesting BRepPrimAPI_MakeBox_4(gp_Pnt, gp_Pnt)...');
          const p1 = new oc.gp_Pnt_3(0, 0, 0);
          const p2 = new oc.gp_Pnt_3(50, 50, 50);
          const box4 = new oc.BRepPrimAPI_MakeBox_4(p1, p2);
          log('  IsDone: ' + box4.IsDone(), box4.IsDone() ? 'success' : 'error');
          if (box4.IsDone()) {
            const shape = box4.Shape();
            log('  Shape created successfully!', 'success');
          }
        } catch (e) {
          log('  Box_4 error: ' + e.message, 'error');
        }

        // Test Sphere
        log('\n=== Testing Sphere Constructors ===');
        try {
          log('Testing BRepPrimAPI_MakeSphere_1 + Init_1(25)...');
          const sphere1 = new oc.BRepPrimAPI_MakeSphere_1();
          if (typeof sphere1.Init_1 === 'function') {
            sphere1.Init_1(25);
            log('  After Init_1, IsDone: ' + sphere1.IsDone(), sphere1.IsDone() ? 'success' : 'error');
          }
        } catch (e) {
          log('  Sphere_1 error: ' + e.message, 'error');
        }

        try {
          log('\nTesting BRepPrimAPI_MakeSphere_2(25)...');
          const sphere2 = new oc.BRepPrimAPI_MakeSphere_2(25);
          log('  IsDone: ' + sphere2.IsDone(), sphere2.IsDone() ? 'success' : 'error');
        } catch (e) {
          log('  Sphere_2 error: ' + e.message, 'error');
        }

        // Test Cylinder
        log('\n=== Testing Cylinder Constructors ===');
        try {
          log('Testing BRepPrimAPI_MakeCylinder_1 + Init_1(25, 50)...');
          const cyl1 = new oc.BRepPrimAPI_MakeCylinder_1();
          if (typeof cyl1.Init_1 === 'function') {
            cyl1.Init_1(25, 50);
            log('  After Init_1, IsDone: ' + cyl1.IsDone(), cyl1.IsDone() ? 'success' : 'error');
          }
        } catch (e) {
          log('  Cyl_1 error: ' + e.message, 'error');
        }

        try {
          log('\nTesting BRepPrimAPI_MakeCylinder_2(25, 50)...');
          const cyl2 = new oc.BRepPrimAPI_MakeCylinder_2(25, 50);
          log('  IsDone: ' + cyl2.IsDone(), cyl2.IsDone() ? 'success' : 'error');
        } catch (e) {
          log('  Cyl_2 error: ' + e.message, 'error');
        }

        // Test Cone
        log('\n=== Testing Cone Constructors ===');
        try {
          log('Testing BRepPrimAPI_MakeCone_1 + Init_1(25, 0, 50)...');
          const cone1 = new oc.BRepPrimAPI_MakeCone_1();
          if (typeof cone1.Init_1 === 'function') {
            cone1.Init_1(25, 0, 50);
            log('  After Init_1, IsDone: ' + cone1.IsDone(), cone1.IsDone() ? 'success' : 'error');
          }
        } catch (e) {
          log('  Cone_1 error: ' + e.message, 'error');
        }

        try {
          log('\nTesting BRepPrimAPI_MakeCone_2(25, 0, 50)...');
          const cone2 = new oc.BRepPrimAPI_MakeCone_2(25, 0, 50);
          log('  IsDone: ' + cone2.IsDone(), cone2.IsDone() ? 'success' : 'error');
        } catch (e) {
          log('  Cone_2 error: ' + e.message, 'error');
        }

        log('\n=== Tests Complete ===', 'success');

      } catch (e) {
        log('Failed to load OpenCascade.js: ' + e.message, 'error');
        console.error(e);
      }
    }

    runTests();
  </script>
</body>
</html>
